# YTRok (Recifra Edition)
> Chrome Extension for Yandex.Telemost

## 1. Бизнес-логика и Цели

### Цель
Минимизировать человеческий фактор при проведении корпоративных созвонов в Яндекс.Телемосте. Сотрудники часто забывают включать запись встречи. Расширение служит "назойливым, но вежливым" напоминанием.

### Юзкейсы (Use Cases)

| Сценарий | Поведение |
|----------|-----------|
| **Вход во встречу** | Пользователь заходит по ссылке. Если он не один (есть другие участники), через 10 секунд появляется ненавязчивое уведомление с вопросом "Включим запись?". |
| **Режим ожидания (Lobby)** | Если пользователь находится на экране настройки (лобби) или в комнате ожидания — уведомление не показывается. |
| **Ожидание коллег** | Если пользователь вошел во встречу, но находится там один (видит экран "Пригласите участников") — таймер не запускается. Как только входит второй участник — запускается таймер на 10 секунд. |
| **Сценарий "Включаю"** | Пользователь нажимает "Включаю". Плашка исчезает. Через 20 секунд появляется контрольная "оранжевая" проверка: "Индикатор точно горит?". |
| **Сценарий "Не нужна"** | Пользователь нажимает "Не нужна" или закрывает окно крестиком. Уведомление больше не беспокоит в рамках текущей сессии браузера (вкладки). |

---

## 2. Техническое решение

### Стек и Архитектура

- **Платформа:** Google Chrome Extension (Manifest V3)
- **Target:** Работает только на домене `telemost.yandex.ru`
- **Architecture:** Content Script only. Без Background Service Worker'ов (для легковесности)
- **Assets:** Логотип компании (Recifra) встроен как Inline SVG прямо в JS код, чтобы избежать проблем с Content Security Policy (CSP) Яндекса и блокировок загрузки локальных ресурсов

### Эвристики (Heuristics)

Расширение определяет состояние SPA (Single Page Application) через циклический опрос (polling) каждые 1000мс. MutationObserver не используется для повышения надежности.

#### Детекция встречи (`isMeetingActive`)
- URL содержит `/j/` (join)
- В DOM присутствует кнопка завершения звонка. Ищется по `title="Выйти из встречи"` (RU-локаль) или классу, содержащему `endCallButton`

#### Детекция одиночества (`isUserAlone`)
- Проверка наличия текста `"Чтобы пригласить других участников"` в `document.body`. Если текст есть — мы одни, алерт блокируется

#### State Management
- Используется `sessionStorage` (ключ `ytrok_suppressed`), чтобы запомнить отказ пользователя от записи
- Состояние сбрасывается при закрытии/перезагрузке вкладки

---

## 3. Структура проекта

```
ytrok-extension/
├── manifest.json   # Конфигурация расширения (V3)
├── content.js      # Основная логика + inline SVG логотип
├── icon128.png     # Иконка расширения
└── README.md       # Этот файл
```

### Файлы

| Файл | Описание |
|------|----------|
| `manifest.json` | Конфигурационный файл расширения (V3). Определяет content_scripts. Ограничивает права доступа (только host permission на телемост). |
| `content.js` | Основная логика. Содержит константу `LOGO_SVG` (inline svg). Реализует watchdogLoop (основной цикл проверки состояния). Управляет DOM-элементами уведомления (создание, удаление, анимация). Обрабатывает клики по кнопкам (Включаю/Не нужно/Закрыть). |
| `icon128.png` | Иконка расширения для отображения в панели браузера и сторе. |

### Особенности стилизации
- Стили инлайновые (внутри JS) для изоляции
- Анимации появления (`@keyframes slideIn`)
- `z-index: 2147483647` (max int), чтобы перекрывать интерфейс видеосвязи
